<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Locate1</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <link rel='stylesheet' type='text/css' media='screen' href='main.css'> -->
    
</head>
<body>
    <h1 id="demo"></h1>
    <button onclick="getLocation()">Locate</button>
    <script>
        const x = document.getElementById("demo");


        const busStops = [
            {name: "Main gate", lat: 6.399858, lon: 5.609137}
        ];

        navigator.geolocation.watchPosition(position => {
            const userLat = position.coords.latitude;
            const userLong = position.coords.longitude;

            checkProximity(userLat, userLong);
        },
        error => {
            console.error("Error getting location:", error);
        },
        {
            enableHighAccuracy: true,
            maximumAge: 0,
            timeout: 100000
        }
    );

    function checkProximity(lat, lon){
        busStops.forEach(stop => {
            const distance = getDistanceFromLatLongInMeters(lat, lon, stop.lat, stop.lon);
            if(distance < 50){
                console.log(`Arrived at ${stop.name}`);
                x.innerHTML = `Arrived at ${stop.name}`
            } else{
                console.log("Not yet There");
                x.innerHTML = "Not yet there";
            }
        });
    }

    function getDistanceFromLatLongInMeters(lat1, lon1, lat2, lon2){
        const R = 6371000;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;

        const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
    }
        // function getLocation(){
        //     if(navigator.geolocation){
        //         navigator.geolocation.getCurrentPosition(success, error);
        //     } else{
        //         x.innerHTML = "Geolocation is not supported by this browser.";
        //     }
        // }

        // function success(position){

        //     x.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude;
        // }

        // function error(){
        //     alert("Sorry, no position available")
        // }
    </script>
</body>
</html>